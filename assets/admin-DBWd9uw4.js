import{s as a}from"./supabaseClient-DvIyazGx.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const G=document.getElementById("login-section"),f=document.getElementById("dashboard-section"),b=document.getElementById("login-form"),s=document.getElementById("login-error"),T=document.getElementById("logout-btn"),L=document.getElementById("user-info"),S=document.getElementById("toast-container"),l=b?.querySelector('button[type="submit"]'),p=document.getElementById("product-table-body"),y=document.getElementById("product-form-container"),u=document.getElementById("product-form"),$=document.getElementById("add-product-btn"),x=document.getElementById("cancel-btn"),E=document.getElementById("event-table-body"),v=document.getElementById("event-form-container"),g=document.getElementById("event-form"),P=document.getElementById("add-event-btn"),H=document.getElementById("cancel-event-btn"),A="Konfigurasi Supabase belum aktif. Jalankan lewat `npm run dev` untuk lokal atau pastikan GitHub Secrets VITE_SUPABASE_URL dan VITE_SUPABASE_ANON_KEY sudah diisi.";function r(t,e="info"){if(!S){e==="error"?console.error(t):console.log(t);return}const n=document.createElement("div");n.className=`toast ${e}`;let o="info-circle";e==="success"&&(o="check-circle"),e==="error"&&(o="exclamation-circle"),n.innerHTML=`<i class="fas fa-${o}"></i> <span>${t}</span>`,S.appendChild(n),setTimeout(()=>{n.classList.add("toast-hide"),setTimeout(()=>n.remove(),300)},4e3)}function U(t=A,e=!1){e&&r(t,"error"),s&&(s.innerText=t,s.style.display="block"),l&&(l.disabled=!0,l.title="Supabase configuration is missing")}function q(){s&&(s.innerText="",s.style.display="none"),l&&(l.disabled=!1,l.title="")}function M(){if(a||document.getElementById("supabase-config-hint"))return;const e=document.querySelector("#login-section .login-box");if(!e)return;const n=document.createElement("p");n.id="supabase-config-hint",n.style.color="#d32f2f",n.style.marginTop="10px",n.style.fontWeight="600",n.innerText="Mode konfigurasi belum siap. Gunakan `npm run dev` (lokal) atau cek Secrets di GitHub.",e.appendChild(n)}function d(t=!1){return a?(q(),!0):(M(),U(A,t),!1)}async function h(){if(!d(!1)){m();return}console.log("Checking authentication status...");try{const{data:t,error:e}=await a.auth.getUser();if(e){console.error("Auth check error:",e),m();return}t.user?(console.log("User found:",t.user.email),_(t.user)):(console.log("No active session."),m())}catch(t){console.error("Critical error in checkUser:",t),m()}}function m(){G.style.display="block",f.style.display="none",f.classList.remove("active")}function _(t){G.style.display="none",f.style.display="block",f.classList.add("active"),L&&(L.innerText=`Halo, ${t.email}`),B(),I()}b&&b.addEventListener("submit",async t=>{if(t.preventDefault(),!d(!0))return;const e=document.getElementById("email").value,n=document.getElementById("password").value;try{const{data:o,error:c}=await a.auth.signInWithPassword({email:e,password:n});c?(r(c.message,"error"),s&&(s.innerText=c.message,s.style.display="block")):(r("Login Berhasil!","success"),h())}catch{r("Gagal terhubung ke server. Pastikan koneksi internet stabil.","error")}});T&&T.addEventListener("click",async()=>{if(!d(!0))return;const{error:t}=await a.auth.signOut();t?r("Gagal Logout: "+t.message,"error"):(r("Berhasil Logout","success"),h())});async function B(){if(d(!1))try{const{data:t,error:e}=await a.from("products").select("*").order("name",{ascending:!0});if(e)throw e;D(t||[])}catch(t){r("Gagal memuat produk: "+t.message,"error")}}function D(t){p&&(p.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td>${e.name||""}</td>
            <td>${e.price||""}</td>
            <td>${e.category||""}</td>
            <td>${e.image||""}</td>
            <td>
                <button class="action-btn btn-edit" data-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,p.appendChild(n)}),document.querySelectorAll("#product-table-body .btn-edit").forEach(e=>{e.addEventListener("click",()=>F(e.dataset.id,t))}),document.querySelectorAll("#product-table-body .btn-delete").forEach(e=>{e.addEventListener("click",()=>N(e.dataset.id))}),window.allProducts=t)}$&&$.addEventListener("click",()=>{u&&u.reset(),document.getElementById("product-id").value="",document.getElementById("form-title").innerText="Tambah Produk Baru",y.style.display="block"});x&&x.addEventListener("click",()=>{y.style.display="none"});function F(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("product-id").value=n.id,document.getElementById("prod-name").value=n.name,document.getElementById("prod-price").value=n.price,document.getElementById("prod-image").value=n.image||"",document.getElementById("prod-category").value=n.category,document.getElementById("form-title").innerText="Edit Produk",y.style.display="block")}async function N(t){if(d(!0)&&confirm("Hapus produk ini?"))try{const{error:e}=await a.from("products").delete().eq("id",t);if(e)throw e;r("Produk berhasil dihapus","success"),B()}catch(e){r("Gagal menghapus: "+e.message,"error")}}u&&u.addEventListener("submit",async t=>{if(t.preventDefault(),!d(!0))return;const e=document.getElementById("product-id").value,n=document.getElementById("prod-image-file").files[0];let c=document.getElementById("prod-image").value;if(n)try{r("Mengupload gambar...","info");const i=`${Date.now()}_${n.name}`,{data:V,error:w}=await a.storage.from("products").upload(i,n);if(w)throw w;const{data:{publicUrl:C}}=a.storage.from("products").getPublicUrl(i);c=C}catch(i){r("Gagal upload gambar: "+i.message,"error");return}const k={name:document.getElementById("prod-name").value,price:document.getElementById("prod-price").value,image:c,category:document.getElementById("prod-category").value};try{if(e){const{error:i}=await a.from("products").update(k).eq("id",e);if(i)throw i;r("Produk berhasil diperbarui","success")}else{const{error:i}=await a.from("products").insert(k);if(i)throw i;r("Produk berhasil ditambah","success")}y.style.display="none",u.reset(),B()}catch(i){r("Gagal menyimpan: "+i.message,"error")}});async function I(){if(d(!1))try{const{data:t,error:e}=await a.from("events").select("*").order("title",{ascending:!0});if(e)throw e;O(t||[])}catch(t){r("Gagal memuat event: "+t.message,"error")}}function O(t){E&&(E.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td><strong>${String(e["event-day"]).padStart(2,"0")}</strong> ${e["event-month"]}</td>
            <td>${e.title||""}</td>
            <td>${e.description||""}</td>
            <td>
                <button class="action-btn btn-edit" data-event-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-event-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,E.appendChild(n)}),document.querySelectorAll("[data-event-id].btn-edit").forEach(e=>{e.addEventListener("click",()=>K(e.dataset.eventId,t))}),document.querySelectorAll("[data-event-id].btn-delete").forEach(e=>{e.addEventListener("click",()=>R(e.dataset.eventId))}))}P&&P.addEventListener("click",()=>{g&&g.reset(),document.getElementById("event-id").value="",document.getElementById("event-form-title").innerText="Tambah Event Baru",v.style.display="block"});H&&H.addEventListener("click",()=>{v.style.display="none"});function K(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("event-id").value=n.id,document.getElementById("event-title").value=n.title,document.getElementById("event-description").value=n.description,document.getElementById("event-day").value=n["event-day"],document.getElementById("event-month").value=n["event-month"],document.getElementById("event-form-title").innerText="Edit Event",v.style.display="block")}async function R(t){if(d(!0)&&confirm("Hapus event ini?"))try{const{error:e}=await a.from("events").delete().eq("id",t);if(e)throw e;r("Event berhasil dihapus","success"),I()}catch(e){r("Gagal menghapus event: "+e.message,"error")}}g&&g.addEventListener("submit",async t=>{if(t.preventDefault(),!d(!0))return;const e=document.getElementById("event-id").value,n={title:document.getElementById("event-title").value,description:document.getElementById("event-description").value,"event-day":parseInt(document.getElementById("event-day").value),"event-month":document.getElementById("event-month").value};try{if(e){const{error:o}=await a.from("events").update(n).eq("id",e);if(o)throw o;r("Event berhasil diperbarui","success")}else{const{error:o}=await a.from("events").insert(n);if(o)throw o;r("Event berhasil ditambah","success")}v.style.display="none",I()}catch(o){r("Gagal menyimpan event: "+o.message,"error")}});d(!1);h();
