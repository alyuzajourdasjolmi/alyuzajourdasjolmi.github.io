import{s as a}from"./supabaseClient-Cyd6nR2Z.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const T=document.getElementById("login-section"),c=document.getElementById("dashboard-section"),h=document.getElementById("login-form"),y=document.getElementById("login-error"),b=document.getElementById("logout-btn"),B=document.getElementById("user-info"),$=document.getElementById("toast-container"),g=document.getElementById("product-table-body"),l=document.getElementById("product-form-container"),i=document.getElementById("product-form"),I=document.getElementById("add-product-btn"),k=document.getElementById("cancel-btn"),v=document.getElementById("event-table-body"),u=document.getElementById("event-form-container"),s=document.getElementById("event-form"),w=document.getElementById("add-event-btn"),L=document.getElementById("cancel-event-btn");function r(t,e="info"){const n=document.createElement("div");n.className=`toast ${e}`;let o="info-circle";e==="success"&&(o="check-circle"),e==="error"&&(o="exclamation-circle"),n.innerHTML=`<i class="fas fa-${o}"></i> <span>${t}</span>`,$.appendChild(n),setTimeout(()=>{n.classList.add("toast-hide"),setTimeout(()=>n.remove(),300)},4e3)}async function f(){if(!a){r("Error: Supabase tidak terhubung. Gunakan 'npm run dev'.","error"),d();return}console.log("Checking authentication status...");try{const{data:t,error:e}=await a.auth.getUser();if(e){console.error("Auth check error:",e),d();return}t.user?(console.log("User found:",t.user.email),P(t.user)):(console.log("No active session."),d())}catch(t){console.error("Critical error in checkUser:",t),d()}}function d(){T.style.display="block",c.style.display="none",c.classList.remove("active")}function P(t){T.style.display="none",c.style.display="block",c.classList.add("active"),B&&(B.innerText=`Halo, ${t.email}`),E(),p()}h&&h.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("email").value,n=document.getElementById("password").value;try{const{data:o,error:m}=await a.auth.signInWithPassword({email:e,password:n});m?(r(m.message,"error"),y&&(y.innerText=m.message,y.style.display="block")):(r("Login Berhasil!","success"),f())}catch{r("Gagal terhubung ke server. Pastikan koneksi internet stabil.","error")}});b&&b.addEventListener("click",async()=>{const{error:t}=await a.auth.signOut();t?r("Gagal Logout: "+t.message,"error"):(r("Berhasil Logout","success"),f())});async function E(){try{const{data:t,error:e}=await a.from("products").select("*").order("name",{ascending:!0});if(e)throw e;H(t||[])}catch(t){r("Gagal memuat produk: "+t.message,"error")}}function H(t){g&&(g.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td>${e.name||""}</td>
            <td>${e.price||""}</td>
            <td>${e.category||""}</td>
            <td>${e.image||""}</td>
            <td>
                <button class="action-btn btn-edit" data-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,g.appendChild(n)}),document.querySelectorAll("#product-table-body .btn-edit").forEach(e=>{e.addEventListener("click",()=>G(e.dataset.id,t))}),document.querySelectorAll("#product-table-body .btn-delete").forEach(e=>{e.addEventListener("click",()=>S(e.dataset.id))}),window.allProducts=t)}I&&I.addEventListener("click",()=>{i&&i.reset(),document.getElementById("product-id").value="",document.getElementById("form-title").innerText="Tambah Produk Baru",l.style.display="block"});k&&k.addEventListener("click",()=>{l.style.display="none"});function G(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("product-id").value=n.id,document.getElementById("prod-name").value=n.name,document.getElementById("prod-price").value=n.price,document.getElementById("prod-image").value=n.image||"",document.getElementById("prod-category").value=n.category,document.getElementById("form-title").innerText="Edit Produk",l.style.display="block")}async function S(t){if(confirm("Hapus produk ini?"))try{const{error:e}=await a.from("products").delete().eq("id",t);if(e)throw e;r("Produk berhasil dihapus","success"),E()}catch(e){r("Gagal menghapus: "+e.message,"error")}}i&&i.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("product-id").value,n={name:document.getElementById("prod-name").value,price:document.getElementById("prod-price").value,image:document.getElementById("prod-image").value,category:document.getElementById("prod-category").value};try{if(e){const{error:o}=await a.from("products").update(n).eq("id",e);if(o)throw o;r("Produk berhasil diperbarui","success")}else{const{error:o}=await a.from("products").insert(n);if(o)throw o;r("Produk berhasil ditambah","success")}l.style.display="none",E()}catch(o){r("Gagal menyimpan: "+o.message,"error")}});async function p(){try{const{data:t,error:e}=await a.from("events").select("*").order("title",{ascending:!0});if(e)throw e;q(t||[])}catch(t){r("Gagal memuat event: "+t.message,"error")}}function q(t){v&&(v.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td><strong>${String(e.event_day).padStart(2,"0")}</strong> ${e.event_month}</td>
            <td>${e.title||""}</td>
            <td>${e.description||""}</td>
            <td>
                <button class="action-btn btn-edit" data-event-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-event-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,v.appendChild(n)}),document.querySelectorAll("[data-event-id].btn-edit").forEach(e=>{e.addEventListener("click",()=>C(e.dataset.eventId,t))}),document.querySelectorAll("[data-event-id].btn-delete").forEach(e=>{e.addEventListener("click",()=>x(e.dataset.eventId))}))}w&&w.addEventListener("click",()=>{s&&s.reset(),document.getElementById("event-id").value="",document.getElementById("event-form-title").innerText="Tambah Event Baru",u.style.display="block"});L&&L.addEventListener("click",()=>{u.style.display="none"});function C(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("event-id").value=n.id,document.getElementById("event-title").value=n.title,document.getElementById("event-description").value=n.description,document.getElementById("event-day").value=n.event_day,document.getElementById("event-month").value=n.event_month,document.getElementById("event-form-title").innerText="Edit Event",u.style.display="block")}async function x(t){if(confirm("Hapus event ini?"))try{const{error:e}=await a.from("events").delete().eq("id",t);if(e)throw e;r("Event berhasil dihapus","success"),p()}catch(e){r("Gagal menghapus event: "+e.message,"error")}}s&&s.addEventListener("submit",async t=>{t.preventDefault();const e=document.getElementById("event-id").value,n={title:document.getElementById("event-title").value,description:document.getElementById("event-description").value,event_day:parseInt(document.getElementById("event-day").value),event_month:document.getElementById("event-month").value};try{if(e){const{error:o}=await a.from("events").update(n).eq("id",e);if(o)throw o;r("Event berhasil diperbarui","success")}else{const{error:o}=await a.from("events").insert(n);if(o)throw o;r("Event berhasil ditambah","success")}u.style.display="none",p()}catch(o){r("Gagal menyimpan event: "+o.message,"error")}});f();
