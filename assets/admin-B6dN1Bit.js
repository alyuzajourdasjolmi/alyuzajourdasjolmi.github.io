import{s as a}from"./supabaseClient-24qygKu3.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const $=document.getElementById("login-section"),l=document.getElementById("dashboard-section"),p=document.getElementById("login-form"),d=document.getElementById("login-error"),I=document.getElementById("logout-btn"),k=document.getElementById("user-info"),w=document.getElementById("toast-container"),s=p?.querySelector('button[type="submit"]'),v=document.getElementById("product-table-body"),f=document.getElementById("product-form-container"),u=document.getElementById("product-form"),L=document.getElementById("add-product-btn"),S=document.getElementById("cancel-btn"),E=document.getElementById("event-table-body"),y=document.getElementById("event-form-container"),m=document.getElementById("event-form"),T=document.getElementById("add-event-btn"),P=document.getElementById("cancel-event-btn"),x="Konfigurasi Supabase belum aktif. Jalankan lewat `npm run dev` untuk lokal atau pastikan GitHub Secrets VITE_SUPABASE_URL dan VITE_SUPABASE_ANON_KEY sudah diisi.";function r(t,e="info"){if(!w){e==="error"?console.error(t):console.log(t);return}const n=document.createElement("div");n.className=`toast ${e}`;let o="info-circle";e==="success"&&(o="check-circle"),e==="error"&&(o="exclamation-circle"),n.innerHTML=`<i class="fas fa-${o}"></i> <span>${t}</span>`,w.appendChild(n),setTimeout(()=>{n.classList.add("toast-hide"),setTimeout(()=>n.remove(),300)},4e3)}function H(t=x,e=!1){e&&r(t,"error"),d&&(d.innerText=t,d.style.display="block"),s&&(s.disabled=!0,s.title="Supabase configuration is missing")}function A(){d&&(d.innerText="",d.style.display="none"),s&&(s.disabled=!1,s.title="")}function C(){if(a||document.getElementById("supabase-config-hint"))return;const e=document.querySelector("#login-section .login-box");if(!e)return;const n=document.createElement("p");n.id="supabase-config-hint",n.style.color="#d32f2f",n.style.marginTop="10px",n.style.fontWeight="600",n.innerText="Mode konfigurasi belum siap. Gunakan `npm run dev` (lokal) atau cek Secrets di GitHub.",e.appendChild(n)}function i(t=!1){return a?(A(),!0):(C(),H(x,t),!1)}async function h(){if(!i(!1)){c();return}console.log("Checking authentication status...");try{const{data:t,error:e}=await a.auth.getUser();if(e){console.error("Auth check error:",e),c();return}t.user?(console.log("User found:",t.user.email),G(t.user)):(console.log("No active session."),c())}catch(t){console.error("Critical error in checkUser:",t),c()}}function c(){$.style.display="block",l.style.display="none",l.classList.remove("active")}function G(t){$.style.display="none",l.style.display="block",l.classList.add("active"),k&&(k.innerText=`Halo, ${t.email}`),b(),B()}p&&p.addEventListener("submit",async t=>{if(t.preventDefault(),!i(!0))return;const e=document.getElementById("email").value,n=document.getElementById("password").value;try{const{data:o,error:g}=await a.auth.signInWithPassword({email:e,password:n});g?(r(g.message,"error"),d&&(d.innerText=g.message,d.style.display="block")):(r("Login Berhasil!","success"),h())}catch{r("Gagal terhubung ke server. Pastikan koneksi internet stabil.","error")}});I&&I.addEventListener("click",async()=>{if(!i(!0))return;const{error:t}=await a.auth.signOut();t?r("Gagal Logout: "+t.message,"error"):(r("Berhasil Logout","success"),h())});async function b(){if(i(!1))try{const{data:t,error:e}=await a.from("products").select("*").order("name",{ascending:!0});if(e)throw e;q(t||[])}catch(t){r("Gagal memuat produk: "+t.message,"error")}}function q(t){v&&(v.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td>${e.name||""}</td>
            <td>${e.price||""}</td>
            <td>${e.category||""}</td>
            <td>${e.image||""}</td>
            <td>
                <button class="action-btn btn-edit" data-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,v.appendChild(n)}),document.querySelectorAll("#product-table-body .btn-edit").forEach(e=>{e.addEventListener("click",()=>U(e.dataset.id,t))}),document.querySelectorAll("#product-table-body .btn-delete").forEach(e=>{e.addEventListener("click",()=>M(e.dataset.id))}),window.allProducts=t)}L&&L.addEventListener("click",()=>{u&&u.reset(),document.getElementById("product-id").value="",document.getElementById("form-title").innerText="Tambah Produk Baru",f.style.display="block"});S&&S.addEventListener("click",()=>{f.style.display="none"});function U(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("product-id").value=n.id,document.getElementById("prod-name").value=n.name,document.getElementById("prod-price").value=n.price,document.getElementById("prod-image").value=n.image||"",document.getElementById("prod-category").value=n.category,document.getElementById("form-title").innerText="Edit Produk",f.style.display="block")}async function M(t){if(i(!0)&&confirm("Hapus produk ini?"))try{const{error:e}=await a.from("products").delete().eq("id",t);if(e)throw e;r("Produk berhasil dihapus","success"),b()}catch(e){r("Gagal menghapus: "+e.message,"error")}}u&&u.addEventListener("submit",async t=>{if(t.preventDefault(),!i(!0))return;const e=document.getElementById("product-id").value,n={name:document.getElementById("prod-name").value,price:document.getElementById("prod-price").value,image:document.getElementById("prod-image").value,category:document.getElementById("prod-category").value};try{if(e){const{error:o}=await a.from("products").update(n).eq("id",e);if(o)throw o;r("Produk berhasil diperbarui","success")}else{const{error:o}=await a.from("products").insert(n);if(o)throw o;r("Produk berhasil ditambah","success")}f.style.display="none",b()}catch(o){r("Gagal menyimpan: "+o.message,"error")}});async function B(){if(i(!1))try{const{data:t,error:e}=await a.from("events").select("*").order("title",{ascending:!0});if(e)throw e;_(t||[])}catch(t){r("Gagal memuat event: "+t.message,"error")}}function _(t){E&&(E.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td><strong>${String(e["event-day"]).padStart(2,"0")}</strong> ${e["event-month"]}</td>
            <td>${e.title||""}</td>
            <td>${e.description||""}</td>
            <td>
                <button class="action-btn btn-edit" data-event-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-event-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,E.appendChild(n)}),document.querySelectorAll("[data-event-id].btn-edit").forEach(e=>{e.addEventListener("click",()=>D(e.dataset.eventId,t))}),document.querySelectorAll("[data-event-id].btn-delete").forEach(e=>{e.addEventListener("click",()=>F(e.dataset.eventId))}))}T&&T.addEventListener("click",()=>{m&&m.reset(),document.getElementById("event-id").value="",document.getElementById("event-form-title").innerText="Tambah Event Baru",y.style.display="block"});P&&P.addEventListener("click",()=>{y.style.display="none"});function D(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("event-id").value=n.id,document.getElementById("event-title").value=n.title,document.getElementById("event-description").value=n.description,document.getElementById("event-day").value=n["event-day"],document.getElementById("event-month").value=n["event-month"],document.getElementById("event-form-title").innerText="Edit Event",y.style.display="block")}async function F(t){if(i(!0)&&confirm("Hapus event ini?"))try{const{error:e}=await a.from("events").delete().eq("id",t);if(e)throw e;r("Event berhasil dihapus","success"),B()}catch(e){r("Gagal menghapus event: "+e.message,"error")}}m&&m.addEventListener("submit",async t=>{if(t.preventDefault(),!i(!0))return;const e=document.getElementById("event-id").value,n={title:document.getElementById("event-title").value,description:document.getElementById("event-description").value,"event-day":parseInt(document.getElementById("event-day").value),"event-month":document.getElementById("event-month").value};try{if(e){const{error:o}=await a.from("events").update(n).eq("id",e);if(o)throw o;r("Event berhasil diperbarui","success")}else{const{error:o}=await a.from("events").insert(n);if(o)throw o;r("Event berhasil ditambah","success")}y.style.display="none",B()}catch(o){r("Gagal menyimpan event: "+o.message,"error")}});i(!1);h();
