import{s as a}from"./supabaseClient-RaokRD3s.js";import"https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";const G=document.getElementById("login-section"),f=document.getElementById("dashboard-section"),h=document.getElementById("login-form"),s=document.getElementById("login-error"),T=document.getElementById("logout-btn"),S=document.getElementById("user-info"),$=document.getElementById("toast-container"),l=h?.querySelector('button[type="submit"]'),E=document.getElementById("product-table-body"),y=document.getElementById("product-form-container"),u=document.getElementById("product-form"),x=document.getElementById("add-product-btn"),P=document.getElementById("cancel-btn"),b=document.getElementById("event-table-body"),p=document.getElementById("event-form-container"),g=document.getElementById("event-form"),H=document.getElementById("add-event-btn"),C=document.getElementById("cancel-event-btn"),A="Konfigurasi Supabase belum aktif. Jalankan lewat `npm run dev` untuk lokal atau pastikan GitHub Secrets VITE_SUPABASE_URL dan VITE_SUPABASE_ANON_KEY sudah diisi.";function r(t,e="info"){if(!$){e==="error"?console.error(t):console.log(t);return}const n=document.createElement("div");n.className=`toast ${e}`;let o="info-circle";e==="success"&&(o="check-circle"),e==="error"&&(o="exclamation-circle"),n.innerHTML=`<i class="fas fa-${o}"></i> <span>${t}</span>`,$.appendChild(n),setTimeout(()=>{n.classList.add("toast-hide"),setTimeout(()=>n.remove(),300)},4e3)}function _(t=A,e=!1){e&&r(t,"error"),s&&(s.innerText=t,s.style.display="block"),l&&(l.disabled=!0,l.title="Supabase configuration is missing")}function M(){s&&(s.innerText="",s.style.display="none"),l&&(l.disabled=!1,l.title="")}function D(){if(a||document.getElementById("supabase-config-hint"))return;const e=document.querySelector("#login-section .login-box");if(!e)return;const n=document.createElement("p");n.id="supabase-config-hint",n.style.color="#d32f2f",n.style.marginTop="10px",n.style.fontWeight="600",n.innerText="Mode konfigurasi belum siap. Gunakan `npm run dev` (lokal) atau cek Secrets di GitHub.",e.appendChild(n)}function d(t=!1){return a?(M(),!0):(D(),_(A,t),!1)}async function B(){if(!d(!1)){m();return}console.log("Checking authentication status...");try{const{data:t,error:e}=await a.auth.getUser();if(e){console.error("Auth check error:",e),m();return}t.user?(console.log("User found:",t.user.email),F(t.user)):(console.log("No active session."),m())}catch(t){console.error("Critical error in checkUser:",t),m()}}function m(){G.style.display="block",f.style.display="none",f.classList.remove("active")}function F(t){G.style.display="none",f.style.display="block",f.classList.add("active"),S&&(S.innerText=`Halo, ${t.email}`),I(),k()}h&&h.addEventListener("submit",async t=>{if(t.preventDefault(),!d(!0))return;const e=document.getElementById("email").value,n=document.getElementById("password").value;try{const{data:o,error:c}=await a.auth.signInWithPassword({email:e,password:n});c?(r(c.message,"error"),s&&(s.innerText=c.message,s.style.display="block")):(r("Login Berhasil!","success"),B())}catch{r("Gagal terhubung ke server. Pastikan koneksi internet stabil.","error")}});T&&T.addEventListener("click",async()=>{if(!d(!0))return;const{error:t}=await a.auth.signOut();t?r("Gagal Logout: "+t.message,"error"):(r("Berhasil Logout","success"),B())});async function I(){if(d(!1))try{const{data:t,error:e}=await a.from("products").select("*").order("name",{ascending:!0});if(e)throw e;N(t||[])}catch(t){r("Gagal memuat produk: "+t.message,"error")}}function N(t){E&&(E.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td>${e.name||""}</td>
            <td>${e.price||""}</td>
            <td>${e.category||""}</td>
            <td>${e.image||""}</td>
            <td>
                <button class="action-btn btn-edit" data-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,E.appendChild(n)}),document.querySelectorAll("#product-table-body .btn-edit").forEach(e=>{e.addEventListener("click",()=>O(e.dataset.id,t))}),document.querySelectorAll("#product-table-body .btn-delete").forEach(e=>{e.addEventListener("click",()=>K(e.dataset.id))}),window.allProducts=t)}x&&x.addEventListener("click",()=>{u&&u.reset(),document.getElementById("product-id").value="",document.getElementById("form-title").innerText="Tambah Produk Baru",y.style.display="block"});P&&P.addEventListener("click",()=>{y.style.display="none"});function O(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("product-id").value=n.id,document.getElementById("prod-name").value=n.name,document.getElementById("prod-price").value=n.price,document.getElementById("prod-image").value=n.image||"",document.getElementById("prod-category").value=n.category,document.getElementById("form-title").innerText="Edit Produk",y.style.display="block")}async function K(t){if(d(!0)&&confirm("Hapus produk ini?"))try{const{error:e}=await a.from("products").delete().eq("id",t);if(e)throw e;r("Produk berhasil dihapus","success"),I()}catch(e){r("Gagal menghapus: "+e.message,"error")}}u&&u.addEventListener("submit",async t=>{if(t.preventDefault(),!d(!0))return;const e=document.getElementById("product-id").value,n=document.getElementById("prod-image-file").files[0];let c=document.getElementById("prod-image").value;if(n)try{r("Mengupload gambar...","info");const i=n.name.split(".").pop(),U=n.name.split(".")[0].replace(/[^a-z0-9]/gi,"_").toLowerCase(),L=`${Date.now()}_${U}.${i}`,{data:z,error:v}=await a.storage.from("products").upload(L,n);if(v)throw console.error("Upload error detail:",v),v;const{data:{publicUrl:q}}=a.storage.from("products").getPublicUrl(L);c=q}catch(i){r("Gagal upload gambar: "+i.message,"error");return}const w={name:document.getElementById("prod-name").value,price:document.getElementById("prod-price").value,image:c,category:document.getElementById("prod-category").value};try{if(e){const{error:i}=await a.from("products").update(w).eq("id",e);if(i)throw i;r("Produk berhasil diperbarui","success")}else{const{error:i}=await a.from("products").insert(w);if(i)throw i;r("Produk berhasil ditambah","success")}y.style.display="none",u.reset(),I()}catch(i){r("Gagal menyimpan: "+i.message,"error")}});async function k(){if(d(!1))try{const{data:t,error:e}=await a.from("events").select("*").order("title",{ascending:!0});if(e)throw e;R(t||[])}catch(t){r("Gagal memuat event: "+t.message,"error")}}function R(t){b&&(b.innerHTML="",t.forEach(e=>{const n=document.createElement("tr");n.innerHTML=`
            <td><strong>${String(e["event-day"]).padStart(2,"0")}</strong> ${e["event-month"]}</td>
            <td>${e.title||""}</td>
            <td>${e.description||""}</td>
            <td>
                <button class="action-btn btn-edit" data-event-id="${e.id}"><i class="fas fa-edit"></i> Edit</button>
                <button class="action-btn btn-delete" data-event-id="${e.id}"><i class="fas fa-trash"></i> Hapus</button>
            </td>
        `,b.appendChild(n)}),document.querySelectorAll("[data-event-id].btn-edit").forEach(e=>{e.addEventListener("click",()=>V(e.dataset.eventId,t))}),document.querySelectorAll("[data-event-id].btn-delete").forEach(e=>{e.addEventListener("click",()=>W(e.dataset.eventId))}))}H&&H.addEventListener("click",()=>{g&&g.reset(),document.getElementById("event-id").value="",document.getElementById("event-form-title").innerText="Tambah Event Baru",p.style.display="block"});C&&C.addEventListener("click",()=>{p.style.display="none"});function V(t,e){const n=e.find(o=>o.id==t);n&&(document.getElementById("event-id").value=n.id,document.getElementById("event-title").value=n.title,document.getElementById("event-description").value=n.description,document.getElementById("event-day").value=n["event-day"],document.getElementById("event-month").value=n["event-month"],document.getElementById("event-form-title").innerText="Edit Event",p.style.display="block")}async function W(t){if(d(!0)&&confirm("Hapus event ini?"))try{const{error:e}=await a.from("events").delete().eq("id",t);if(e)throw e;r("Event berhasil dihapus","success"),k()}catch(e){r("Gagal menghapus event: "+e.message,"error")}}g&&g.addEventListener("submit",async t=>{if(t.preventDefault(),!d(!0))return;const e=document.getElementById("event-id").value,n={title:document.getElementById("event-title").value,description:document.getElementById("event-description").value,"event-day":parseInt(document.getElementById("event-day").value),"event-month":document.getElementById("event-month").value};try{if(e){const{error:o}=await a.from("events").update(n).eq("id",e);if(o)throw o;r("Event berhasil diperbarui","success")}else{const{error:o}=await a.from("events").insert(n);if(o)throw o;r("Event berhasil ditambah","success")}p.style.display="none",k()}catch(o){r("Gagal menyimpan event: "+o.message,"error")}});d(!1);B();
